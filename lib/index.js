import{decodeUInt64 as d}from"leb";import{decompress as h}from"lzma";function p(s){if(s===0)return s;let r=[];for(let e=0;e<31;e++)(s&1<<e)>>e&&r.push(e);return r.includes(9)&&r.splice(r.indexOf(6),1),r.length>1?r:r[0]}var t=0,o=[],l=new TextDecoder("utf-8",{fatal:!0});function f(){return t++,o[t-1]}function n(s){return t+=s,o.slice(t-s,t).reduceRight((r,e)=>r*256+e)}function i(){if(o[t]===11){t++;let s=d(o.slice(t,t+8)),r=s.value;return t+=r+s.nextIndex,l.decode(Uint8Array.from(o.slice(t-r,t)))}return t++,""}function v(s,r=!1){let e=[];t=0,o.length=0;for(let u of s)o.push(u);e.push(f()),e.push(n(4));for(let u=0;u<3;u++)e.push(i());for(let u=0;u<6;u++)e.push(n(2));e.push(n(4)),e.push(n(2)),e.push(f()),e.push(n(4)),e.push(i()),e.push(n(8));let c=n(4);return e.push(c),t+=c,r||e.push(h(o.slice(t-c,t))),e.push(n(8)),t+7<o.length&&e.push(n(8)),e}function y(s,r=!1){let e=s;return r&&(e[14]=p(e[14])),e}export{y as decode,v as parse};
