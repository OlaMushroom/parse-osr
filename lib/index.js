import{decodeUInt64 as l}from"leb";import{decompress as m}from"lzma";function u(t){if(t===0)return t;let r=[];for(let e=0;e<31;e++)(t&1<<e)>>e&&r.push(e);return r.includes(9)&&r.splice(r.indexOf(6),1),r.length>1?r:r[0]}var p=t=>t.split(",").slice(0,-1).map(r=>r.split("|").map(e=>Number(e))),f=t=>new Date(Number((BigInt(t)-621355968000000000n)/10000n));var o=0,n=[],h=new TextDecoder("utf-8",{fatal:!0});function d(){return o++,n[o-1]}function s(t){return o+=t,n.slice(o-t,o).reduceRight((r,e)=>r*256+e)}function a(){if(n[o]===11){o++;let t=l(n.slice(o,o+8)),r=t.value;return o+=r+t.nextIndex,h.decode(Uint8Array.from(n.slice(o-r,o)))}return o++,""}function B(t,r=!1){o=0,n.length=0,n=[...t];let e=[];e.push(d()),e.push(s(4));for(let i=0;i<3;i++)e.push(a());for(let i=0;i<6;i++)e.push(s(2));e.push(s(4)),e.push(s(2)),e.push(d()),e.push(s(4)),e.push(a()),e.push(s(8));let c=s(4);return e.push(c),o+=c,r?e.push(""):e.push(m(Uint8Array.from(n.slice(o-c,o)))),e.push(s(8)),o+7<n.length&&e.push(s(8)),e}function D(t,r){let e=t;return r.mods&&(e[14]=u(e[14])),r.lifeBar&&(e[15]=p(e[15])),r.time&&(e[16]=f(e[16])),r.replayData&&(e[18]=p(e[18])),e}var k=t=>Object.fromEntries(["mode","ver","mapHash","name","replayHash","great","ok","meh","geki","katu","miss","score","combo","perfect","mods","lifeBar","time","length","replayData","id","tp"].map((r,e)=>[r,t[e]]));export{D as decode,k as objectify,B as parse};
