import{decodeUInt64 as m}from"leb";import{decompress as a}from"lzma";function u(r){if(r===0)return r;let t=[];for(let e=0;e<31;e++)(r&1<<e)>>e&&t.push(e);return t.includes(9)&&t.splice(t.indexOf(6),1),t.length>1?t:t[0]}var p=r=>r.split(",").slice(0,-1).map(t=>t.split("|").map(e=>Number(e))),d=r=>new Date(Number((BigInt(r)-621355968000000000n)/10000n));var o=0,n=[],h=new TextDecoder;function f(){return o++,n[o-1]}function s(r){return o+=r,n.slice(o-r,o).reduceRight((t,e)=>t*256+e)}function l(){if(n[o]===11){o++;let r=m(n.slice(o,o+8)),t=r.value;return o+=t+r.nextIndex,h.decode(Uint8Array.from(n.slice(o-t,o)))}return o++,""}function k(r,t=!1){o=0,n.length=0,n=[...r];let e=[];e.push(f()),e.push(s(4));for(let i=0;i<3;i++)e.push(l());for(let i=0;i<6;i++)e.push(s(2));e.push(s(4)),e.push(s(2)),e.push(f()),e.push(s(4)),e.push(l()),e.push(s(8));let c=s(4);return e.push(c),o+=c,t?e.push(""):e.push(a(n.slice(o-c,o))),e.push(s(8)),o+7<n.length&&e.push(s(8)),e}function y(r,t){let e=r;return t.mods&&(e[14]=u(e[14])),t.lifeBar&&(e[15]=p(e[15])),t.time&&(e[16]=d(e[16])),t.replayData&&(e[18]=p(e[18])),e}var D=r=>Object.fromEntries(["mode","ver","map","name","hash","great","ok","meh","geki","katu","miss","score","combo","perfect","mods","lifeBar","time","length","data","id","tp"].map((t,e)=>[t,r[e]]));export{y as decode,D as objectify,k as parse};
