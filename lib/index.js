import{decodeUInt64 as h}from"leb";import{decompress as d}from"lzma";function p(t){if(t===0)return t;let o=[];for(let e=0;e<31;e++)(t&1<<e)>>e&&o.push(e);return o.length>1?o:o[0]}var r=0,n=[],l=new TextDecoder("utf-8",{fatal:!0});function f(){return r++,n[r-1]}function s(t){return r+=t,n.slice(r-t,r).reduceRight((o,e)=>o*256+e)}function i(){if(n[r]===11){r++;let t=h(n.slice(r,r+8)),o=t.value;return r+=o+t.nextIndex,l.decode(Uint8Array.from(n.slice(r-o,r)))}return r++,""}function v(t,o=!1){let e=[];r=0,n.length=0;for(let u of t)n.push(u);e.push(f()),e.push(s(4));for(let u=0;u<3;u++)e.push(i());for(let u=0;u<6;u++)e.push(s(2));e.push(s(4)),e.push(s(2)),e.push(f()),e.push(s(4)),e.push(i()),e.push(s(8));let c=s(4);return e.push(c),r+=c,o||e.push(d(n.slice(r-c,r))),e.push(s(8)),r+7<n.length&&e.push(s(8)),e}function y(t,o=!1){let e=t;return o&&(e[14]=p(e[14])),e}export{y as decode,v as parse};
