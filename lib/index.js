import{decodeUInt64 as d}from"leb";import{decompress as l}from"lzma";var a=new TextDecoder,s=0,o=[];function p(){return s++,o[s-1]}function n(t){return s+=t,o.slice(s-t,s).reduceRight((r,e)=>r*256+e)}function u(){if(o[s]===11){s++;let t=d(o.slice(s,s+8)),r=t.value;return s+=r+t.nextIndex,a.decode(Uint8Array.from(o.slice(s-r,s)))}return s++,""}function m(t,r=!1){s=0,o=[...t];let e=[];e.push(p()),e.push(n(4));for(let i=0;i<3;i++)e.push(u());for(let i=0;i<6;i++)e.push(n(2));e.push(n(4)),e.push(n(2)),e.push(p()),e.push(n(4)),e.push(u()),e.push(n(8));let c=n(4);return e.push(c),s+=c,r?e.push(""):e.push(l(o.slice(s-c,s))),e.push(n(8)),s+7<o.length&&e.push(n(8)),e}var f=t=>t.split(",").slice(0,-1).map(r=>r.split("|").map(e=>Number(e))),h=t=>new Date(Number((BigInt(t)-621355968000000000n)/10000n));function x(t){if(t===0)return t;let r=[];for(let e=0;e<31;e++)(t&1<<e)>>e&&r.push(e);return r.includes(9)&&r.splice(r.indexOf(6),1),r.length>1?r:r[0]}function g(t,r){let e=t;return r.mods&&(e[14]=x(e[14])),r.lifeBar&&(e[15]=f(e[15])),r.time&&(e[16]=h(e[16])),r.replayData&&(e[18]=f(e[18])),e}var D=t=>Object.fromEntries(["mode","ver","map","name","hash","great","ok","meh","geki","katu","miss","score","combo","perfect","mods","lifeBar","time","length","data","id","tp"].map((r,e)=>[r,t[e]]));export{g as decode,D as objectify,m as parse};
